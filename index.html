<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sheikh Zada — JWT Generator</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#94a3b8;--accent:#6ee7b7;--accent2:#60a5fa}
    body{margin:0;font-family:Inter,ui-sans-serif;background:#071027;color:#e6eef8;display:flex;justify-content:center;padding:20px}
    .app{max-width:1000px;width:100%;background:#0b1220;border-radius:12px;padding:20px;box-shadow:0 8px 30px rgba(0,0,0,0.5)}
    header{display:flex;align-items:center;gap:14px;margin-bottom:12px}
    .logo{width:62px;height:62px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:700;color:#032}
    h1{font-size:20px;margin:0}
    .card{background:rgba(255,255,255,0.02);padding:14px;border-radius:10px;margin-top:12px}
    input[type=text], input[type=number], textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;font-size:13px;margin-top:5px;}
    textarea{min-height:100px;resize:vertical}
    .btn{padding:8px 12px;border:none;border-radius:8px;cursor:pointer;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#042;font-weight:600;margin:4px 0}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.1);color:var(--accent)}
    table{width:100%;border-collapse:collapse;margin-top:10px;font-size:13px}
    th,td{padding:6px 8px;border-bottom:1px solid rgba(255,255,255,0.05);word-break:break-all;text-align:left}
    .status-success{color:#9ae6b4}
    .status-error{color:#f87171}
    footer{text-align:center;margin-top:14px;color:var(--muted);font-size:12px}
    .summary{margin:10px 0;font-size:14px}
    .settings{margin-top:10px;display:flex;gap:10px;flex-wrap:wrap;}
    .settings label{font-size:12px;color:var(--muted);}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="logo">SZ</div>
      <div>
        <h1>Sheikh Zada — JWT Generator</h1>
      </div>
    </header>

    <div class="card">
      <h3>Input</h3>
      <input id="fileInput" type="file" accept="application/json,text/plain" class="btn ghost">
      <textarea id="pasteArea" placeholder='Paste JSON or uid,password lines here'></textarea>
      <div class="settings">
        <label>Parallel Limit: <input id="parallelLimit" type="number" value="3" min="1" style="width:60px"></label>
        <label>Min Delay(ms): <input id="minDelay" type="number" value="300" min="0" style="width:60px"></label>
        <label>Max Delay(ms): <input id="maxDelay" type="number" value="700" min="0" style="width:60px"></label>
      </div>
      <div style="margin-top:10px">
        <button id="startBtn" class="btn">Generate</button>
        <button id="retryDeadBtn" class="btn ghost" style="display:none">Retry Dead UID</button>
      </div>
      <div class="summary">
        Total: <span id="total">0</span> | 
        ✅ Live: <span id="liveCount">0</span> | 
        ❌ Dead: <span id="deadCount">0</span>
      </div>
    </div>

    <div class="card">
      <h3>✅ Live UIDs</h3>
      <div id="liveWrap"><div>No Live UID yet</div></div>
      <button id="downloadLive" class="btn ghost" style="display:none">Download Live CSV</button>
    </div>

    <div class="card">
      <h3>❌ Dead UIDs</h3>
      <div id="deadWrap"><div>No Dead UID yet</div></div>
    </div>

    <footer>Sheikh Zada</footer>
  </div>

<script>
async function parseInput() {
  const txt = document.getElementById("pasteArea").value.trim();
  let parsed = [];
  if (txt) {
    try {
      if (txt.startsWith("[")) parsed = JSON.parse(txt);
      else if (txt.startsWith("{")) parsed = [JSON.parse(txt)];
      else parsed = txt.split(/\n+/).map(line => {
        const [uid, password] = line.split(/,|\s+/);
        return { uid, password };
      });
    } catch { alert("Invalid pasted data"); }
  }
  return parsed;
}

document.getElementById("fileInput").addEventListener("change", async (e) => {
  const file = e.target.files[0];
  if (!file) return;
  const text = await file.text();
  document.getElementById("pasteArea").value = text;
});

async function fetchWithRetry(url, attempts = 5) {
  let delay = 300;
  for (let i = 0; i < attempts; i++) {
    try {
      const res = await fetch(url);
      if (!res.ok) throw new Error(`Status ${res.status}`);
      const text = await res.text();
      try { return JSON.parse(text); } catch { return { token: text }; }
    } catch (e) {
      if (i === attempts - 1) throw e;
      await new Promise(r => setTimeout(r, delay));
      delay *= 2;
    }
  }
}

async function asyncPool(limit, array, iteratorFn) {
  const ret = [];
  const executing = [];
  for (const item of array) {
    const p = Promise.resolve().then(() => iteratorFn(item));
    ret.push(p);
    if (limit <= array.length) {
      const e = p.then(() => executing.splice(executing.indexOf(e), 1));
      executing.push(e);
      if (executing.length >= limit) await Promise.race(executing);
    }
  }
  return Promise.allSettled(ret);
}

const liveRows = [];
let deadRows = [];

const base = "https://jnl-gen-jwt.vercel.app/token";
const proxies = [
  "https://api.allorigins.win/raw?url=",
  "https://cors-anywhere.herokuapp.com/",
  "https://thingproxy.freeboard.io/fetch/"
];

async function processUIDs(data) {
  const parallelLimit = parseInt(document.getElementById("parallelLimit").value) || 3;
  const minDelay = parseInt(document.getElementById("minDelay").value) || 300;
  const maxDelay = parseInt(document.getElementById("maxDelay").value) || 700;

  await asyncPool(parallelLimit, data, async (it) => {
    try {
      const randDelay = Math.floor(Math.random() * (maxDelay - minDelay + 1) + minDelay);
      await new Promise(r => setTimeout(r, randDelay));
      const proxy = proxies[Math.floor(Math.random() * proxies.length)];
      const url = `${base}?uid=${encodeURIComponent(it.uid)}&password=${encodeURIComponent(it.password)}`;
      const json = await fetchWithRetry(proxy + encodeURIComponent(url), 5);
      const token = json.token || json.jwt || json.access_token;
      if (token) {
        liveRows.push({uid: it.uid, token, status:"Live"});
        deadRows = deadRows.filter(d => d.uid !== it.uid);
      } else {
        deadRows.push({uid: it.uid, status:"Dead", error:"No token"});
      }
    } catch (e) {
      deadRows.push({uid: it.uid, status:"Dead", error:e.message});
    }
    updateTables();
  });
}

function updateTables() {
  // Live table
  document.getElementById("liveWrap").innerHTML = liveRows.length
    ? `<table><thead><tr><th>UID</th><th>Status</th><th>Token</th></tr></thead><tbody>${liveRows.map(r=>`<tr><td>${r.uid}</td><td class="status-success">${r.status}</td><td>${r.token}</td></tr>`).join("")}</tbody></table>`
    : "<div>No Live UID yet</div>";
  // Dead table
  document.getElementById("deadWrap").innerHTML = deadRows.length
    ? `<table><thead><tr><th>UID</th><th>Status</th><th>Error</th></tr></thead><tbody>${deadRows.map(r=>`<tr><td>${r.uid}</td><td class="status-error">${r.status}</td><td>${r.error||""}</td></tr>`).join("")}</tbody></table>`
    : "<div>No Dead UID yet</div>";
  document.getElementById("liveCount").textContent = liveRows.length;
  document.getElementById("deadCount").textContent = deadRows.length;

  if(liveRows.length) {
    const btn = document.getElementById("downloadLive");
    btn.style.display = "inline-block";
    btn.onclick = () => {
      const csv = ["UID,Status,Token"].concat(liveRows.map(r=>`${r.uid},${r.status},${r.token}`)).join("\n");
      const blob = new Blob([csv], {type:"text/csv"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "live_tokens.csv";
      a.click();
    };
  }
  document.getElementById("retryDeadBtn").style.display = deadRows.length ? "inline-block" : "none";
}

document.getElementById("startBtn").addEventListener("click", async () => {
  liveRows.length = 0;
  deadRows = [];
  const data = await parseInput();
  if(!data.length) return alert("No input data");
  document.getElementById("total").textContent = data.length;
  await processUIDs(data);
});

document.getElementById("retryDeadBtn").addEventListener("click", async () => {
  if(!deadRows.length) return;
  const retryData = [...deadRows];
  deadRows = [];
  await processUIDs(retryData);
});
</script>
</body>
</html>
